{
  "lambda(){if(%operand1) { 1 } else { if(%operand2){1}else{0} }}()": "[{\"body\":{\"function\":{\"body\":[{\"true\":[{\"body\":{\"type\":\"int-lit\",\"value\":1},\"type\":\"exp\"}],\"false\":[{\"true\":[{\"body\":{\"type\":\"int-lit\",\"value\":1},\"type\":\"exp\"}],\"false\":[{\"body\":{\"type\":\"int-lit\",\"value\":0},\"type\":\"exp\"}],\"type\":\"if\",\"condition\":{\"type\":\"macro\",\"name\":\"operand2\"}}],\"type\":\"if\",\"condition\":{\"type\":\"macro\",\"name\":\"operand1\"}}],\"type\":\"lambda\",\"arguments\":[]},\"type\":\"call\",\"arguments\":[]},\"type\":\"exp\"}]",
  "lambda(){def %u1 = lambda(cond, b){ite(cond(), lambda(){b(); %u1(cond,b)},lambda(){})();}; %u1(lambda(){%condition},lambda(){ %body})}()": "[{\"body\":{\"function\":{\"body\":[{\"type\":\"def\",\"name\":{\"type\":\"macro\",\"name\":\"u1\"},\"value\":{\"body\":[{\"body\":{\"function\":{\"true\":{\"body\":[{\"body\":{\"function\":{\"type\":\"id\",\"name\":\"b\"},\"type\":\"call\",\"arguments\":[]},\"type\":\"exp\"},{\"body\":{\"function\":{\"type\":\"macro\",\"name\":\"u1\"},\"type\":\"call\",\"arguments\":[{\"type\":\"id\",\"name\":\"cond\"},{\"type\":\"id\",\"name\":\"b\"}]},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[]},\"false\":{\"body\":[],\"type\":\"lambda\",\"arguments\":[]},\"type\":\"ite\",\"condition\":{\"function\":{\"type\":\"id\",\"name\":\"cond\"},\"type\":\"call\",\"arguments\":[]}},\"type\":\"call\",\"arguments\":[]},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[{\"type\":\"id\",\"name\":\"cond\"},{\"type\":\"id\",\"name\":\"b\"}]}},{\"body\":{\"function\":{\"type\":\"macro\",\"name\":\"u1\"},\"type\":\"call\",\"arguments\":[{\"body\":[{\"body\":{\"type\":\"macro\",\"name\":\"condition\"},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[]},{\"body\":[{\"body\":{\"type\":\"macro\",\"name\":\"body\"},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[]}]},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[]},\"type\":\"call\",\"arguments\":[]},\"type\":\"exp\"}]",
  "ite(%condition, lambda() {%true}, lambda() {%false})()": "[{\"body\":{\"function\":{\"true\":{\"body\":[{\"body\":{\"type\":\"macro\",\"name\":\"true\"},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[]},\"false\":{\"body\":[{\"body\":{\"type\":\"macro\",\"name\":\"false\"},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[]},\"type\":\"ite\",\"condition\":{\"type\":\"macro\",\"name\":\"condition\"}},\"type\":\"call\",\"arguments\":[]},\"type\":\"exp\"}]",
  "lambda(){if(%operand1) { if(%operand2){1}else{0} } else{0} }()": "[{\"body\":{\"function\":{\"body\":[{\"true\":[{\"true\":[{\"body\":{\"type\":\"int-lit\",\"value\":1},\"type\":\"exp\"}],\"false\":[{\"body\":{\"type\":\"int-lit\",\"value\":0},\"type\":\"exp\"}],\"type\":\"if\",\"condition\":{\"type\":\"macro\",\"name\":\"operand2\"}}],\"false\":[{\"body\":{\"type\":\"int-lit\",\"value\":0},\"type\":\"exp\"}],\"type\":\"if\",\"condition\":{\"type\":\"macro\",\"name\":\"operand1\"}}],\"type\":\"lambda\",\"arguments\":[]},\"type\":\"call\",\"arguments\":[]},\"type\":\"exp\"}]",
  "lambda(){def %u1={}; def %u2=0; for(%name in %iterable){%u1[%u2]=lambda(%name){%expression}(%name); %u2=%u2+1;}; %u1;}()": "[{\"body\":{\"function\":{\"body\":[{\"type\":\"def\",\"name\":{\"type\":\"macro\",\"name\":\"u1\"},\"value\":{\"type\":\"dict-lit\",\"value\":[]}},{\"type\":\"def\",\"name\":{\"type\":\"macro\",\"name\":\"u2\"},\"value\":{\"type\":\"int-lit\",\"value\":0}},{\"body\":[{\"dict\":{\"type\":\"macro\",\"name\":\"u1\"},\"type\":\"put\",\"value\":{\"function\":{\"body\":[{\"body\":{\"type\":\"macro\",\"name\":\"expression\"},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[{\"type\":\"macro\",\"name\":\"name\"}]},\"type\":\"call\",\"arguments\":[{\"type\":\"macro\",\"name\":\"name\"}]},\"field\":{\"type\":\"macro\",\"name\":\"u2\"}},{\"type\":\"asgn\",\"name\":{\"type\":\"macro\",\"name\":\"u2\"},\"value\":{\"operand1\":{\"type\":\"macro\",\"name\":\"u2\"},\"type\":\"+\",\"operand2\":{\"type\":\"int-lit\",\"value\":1}}}],\"type\":\"for\",\"name\":{\"type\":\"macro\",\"name\":\"name\"},\"iterable\":{\"type\":\"macro\",\"name\":\"iterable\"}},{\"body\":{\"type\":\"macro\",\"name\":\"u1\"},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[]},\"type\":\"call\",\"arguments\":[]},\"type\":\"exp\"}]",
  "lambda(){def %u2 = null; def %u3 = %iterable;if(type(%u3)=='table'){%u2=_getIterator_(%u3);}else{%u2=%u3};def %name = %u2();while(%name!=null) {lambda(%name){%body}(%name); %name = %u2();}}()": "[{\"body\":{\"function\":{\"body\":[{\"type\":\"def\",\"name\":{\"type\":\"macro\",\"name\":\"u2\"},\"value\":{\"type\":\"null\"}},{\"type\":\"def\",\"name\":{\"type\":\"macro\",\"name\":\"u3\"},\"value\":{\"type\":\"macro\",\"name\":\"iterable\"}},{\"true\":[{\"type\":\"asgn\",\"name\":{\"type\":\"macro\",\"name\":\"u2\"},\"value\":{\"function\":{\"type\":\"id\",\"name\":\"_getIterator_\"},\"type\":\"call\",\"arguments\":[{\"type\":\"macro\",\"name\":\"u3\"}]}}],\"false\":[{\"type\":\"asgn\",\"name\":{\"type\":\"macro\",\"name\":\"u2\"},\"value\":{\"type\":\"macro\",\"name\":\"u3\"}}],\"type\":\"if\",\"condition\":{\"operand1\":{\"function\":{\"type\":\"id\",\"name\":\"type\"},\"type\":\"call\",\"arguments\":[{\"type\":\"macro\",\"name\":\"u3\"}]},\"type\":\"==\",\"operand2\":{\"type\":\"string-lit\",\"value\":\"table\"}}},{\"type\":\"def\",\"name\":{\"type\":\"macro\",\"name\":\"name\"},\"value\":{\"function\":{\"type\":\"macro\",\"name\":\"u2\"},\"type\":\"call\",\"arguments\":[]}},{\"body\":[{\"body\":{\"function\":{\"body\":[{\"body\":{\"type\":\"macro\",\"name\":\"body\"},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[{\"type\":\"macro\",\"name\":\"name\"}]},\"type\":\"call\",\"arguments\":[{\"type\":\"macro\",\"name\":\"name\"}]},\"type\":\"exp\"},{\"type\":\"asgn\",\"name\":{\"type\":\"macro\",\"name\":\"name\"},\"value\":{\"function\":{\"type\":\"macro\",\"name\":\"u2\"},\"type\":\"call\",\"arguments\":[]}}],\"type\":\"while\",\"condition\":{\"operand1\":{\"type\":\"macro\",\"name\":\"name\"},\"type\":\"!=\",\"operand2\":{\"type\":\"null\"}}}],\"type\":\"lambda\",\"arguments\":[]},\"type\":\"call\",\"arguments\":[]},\"type\":\"exp\"}]",
  "## TODO: Make Object!\n#\n# The base class in our object hierarchy. All other classes must inherit from\n# the root Object class. Has two methods:\n# \n# 1) new: A constructor-like method that implements prototype-based inheritance.\n# All Object instances as well as its subclasses are constructed with this\n# method. See http://www.lua.org/pil/16.2.html for details.\n#\n\ndef Object = {}\n\nObject.new = lambda(self, obj) {\nif(obj==null){\nobj={}\n}\nsetmetatable(obj, self);\nself.__index = self;\nprint \"abvddsfdssf\"\nprint 5\nprint 4\nobj;\n}\n\n": "[{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"Object\"},\"value\":{\"type\":\"dict-lit\",\"value\":[]}},{\"dict\":{\"type\":\"id\",\"name\":\"Object\"},\"type\":\"put\",\"value\":{\"body\":[{\"true\":[{\"type\":\"asgn\",\"name\":{\"type\":\"id\",\"name\":\"obj\"},\"value\":{\"type\":\"dict-lit\",\"value\":[]}}],\"false\":[],\"type\":\"if\",\"condition\":{\"operand1\":{\"type\":\"id\",\"name\":\"obj\"},\"type\":\"==\",\"operand2\":{\"type\":\"null\"}}},{\"body\":{\"function\":{\"type\":\"id\",\"name\":\"setmetatable\"},\"type\":\"call\",\"arguments\":[{\"type\":\"id\",\"name\":\"obj\"},{\"type\":\"id\",\"name\":\"self\"}]},\"type\":\"exp\"},{\"dict\":{\"type\":\"id\",\"name\":\"self\"},\"type\":\"put\",\"value\":{\"type\":\"id\",\"name\":\"self\"},\"field\":{\"type\":\"string-lit\",\"value\":\"__index\"}},{\"type\":\"print\",\"value\":{\"type\":\"string-lit\",\"value\":\"abvddsfdssf\"}},{\"type\":\"print\",\"value\":{\"type\":\"int-lit\",\"value\":5}},{\"type\":\"print\",\"value\":{\"type\":\"int-lit\",\"value\":4}},{\"body\":{\"type\":\"id\",\"name\":\"obj\"},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[{\"type\":\"id\",\"name\":\"self\"},{\"type\":\"id\",\"name\":\"obj\"}]},\"field\":{\"type\":\"string-lit\",\"value\":\"new\"}}]",
  "def False = 0\r\ndef True = 1\r\n\r\ndef not(b) {if (b) {False} else {True}}\r\ndef max(x,y) { if (x>y) { x } else { y } }\r\n\r\n# Return an iterator for a list\r\n# list is a dictionary\r\n# this iterator iterates over keys 0 .. len(list)-1\r\n# If want, you can use that function when desugaring for.\r\ndef _getIterator_(list) {\r\n    # 0-1 because we currently don't support unary minus\r\n    def i = 0-1\r\n    lambda() {\r\n         i = i + 1\r\n         if (i < len(list)) { list[i]\r\n         } else { null } # terminates iteration\r\n    } \r\n}\r\n    \r\n# append o to list; return the list\r\ndef append(list,o) {\r\n    list[len(list)]=o\r\n}\r\n\r\n# Metatables\r\ndef setmetatable(o,t) {\r\n    o.__mt = t\r\n} \r\ndef getmetatable(o) {\r\n    o.__mt\r\n}\r\n\r\n\r\n": "[{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"False\"},\"value\":{\"type\":\"int-lit\",\"value\":0}},{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"True\"},\"value\":{\"type\":\"int-lit\",\"value\":1}},{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"not\"},\"value\":{\"body\":[{\"true\":[{\"body\":{\"type\":\"id\",\"name\":\"False\"},\"type\":\"exp\"}],\"false\":[{\"body\":{\"type\":\"id\",\"name\":\"True\"},\"type\":\"exp\"}],\"type\":\"if\",\"condition\":{\"type\":\"id\",\"name\":\"b\"}}],\"type\":\"lambda\",\"arguments\":[{\"type\":\"id\",\"name\":\"b\"}]}},{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"max\"},\"value\":{\"body\":[{\"true\":[{\"body\":{\"type\":\"id\",\"name\":\"x\"},\"type\":\"exp\"}],\"false\":[{\"body\":{\"type\":\"id\",\"name\":\"y\"},\"type\":\"exp\"}],\"type\":\"if\",\"condition\":{\"operand1\":{\"type\":\"id\",\"name\":\"x\"},\"type\":\">\",\"operand2\":{\"type\":\"id\",\"name\":\"y\"}}}],\"type\":\"lambda\",\"arguments\":[{\"type\":\"id\",\"name\":\"x\"},{\"type\":\"id\",\"name\":\"y\"}]}},{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"_getIterator_\"},\"value\":{\"body\":[{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"i\"},\"value\":{\"operand1\":{\"type\":\"int-lit\",\"value\":0},\"type\":\"-\",\"operand2\":{\"type\":\"int-lit\",\"value\":1}}},{\"body\":{\"body\":[{\"type\":\"asgn\",\"name\":{\"type\":\"id\",\"name\":\"i\"},\"value\":{\"operand1\":{\"type\":\"id\",\"name\":\"i\"},\"type\":\"+\",\"operand2\":{\"type\":\"int-lit\",\"value\":1}}},{\"true\":[{\"body\":{\"dict\":{\"type\":\"id\",\"name\":\"list\"},\"type\":\"get\",\"field\":{\"type\":\"id\",\"name\":\"i\"}},\"type\":\"exp\"}],\"false\":[{\"body\":{\"type\":\"null\"},\"type\":\"exp\"}],\"type\":\"if\",\"condition\":{\"operand1\":{\"type\":\"id\",\"name\":\"i\"},\"type\":\"<\",\"operand2\":{\"dict\":{\"type\":\"id\",\"name\":\"list\"},\"type\":\"len\"}}}],\"type\":\"lambda\",\"arguments\":[]},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[{\"type\":\"id\",\"name\":\"list\"}]}},{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"append\"},\"value\":{\"body\":[{\"dict\":{\"type\":\"id\",\"name\":\"list\"},\"type\":\"put\",\"value\":{\"type\":\"id\",\"name\":\"o\"},\"field\":{\"dict\":{\"type\":\"id\",\"name\":\"list\"},\"type\":\"len\"}}],\"type\":\"lambda\",\"arguments\":[{\"type\":\"id\",\"name\":\"list\"},{\"type\":\"id\",\"name\":\"o\"}]}},{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"setmetatable\"},\"value\":{\"body\":[{\"dict\":{\"type\":\"id\",\"name\":\"o\"},\"type\":\"put\",\"value\":{\"type\":\"id\",\"name\":\"t\"},\"field\":{\"type\":\"string-lit\",\"value\":\"__mt\"}}],\"type\":\"lambda\",\"arguments\":[{\"type\":\"id\",\"name\":\"o\"},{\"type\":\"id\",\"name\":\"t\"}]}},{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"getmetatable\"},\"value\":{\"body\":[{\"body\":{\"dict\":{\"type\":\"id\",\"name\":\"o\"},\"type\":\"get\",\"field\":{\"type\":\"string-lit\",\"value\":\"__mt\"}},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[{\"type\":\"id\",\"name\":\"o\"}]}}]",
  "def feedCo(){\n    def sc=sourceCo()\n    print\"Created source coroutine.\"\n    process(sc)\n}\n\ndef process(sc){\n    \n    def processCoFun(unused){\n        \n        def x1=resume(sc,null)\n        print\"Running process coroutine.\"\n        yield(\"First:\"+x1)\n        def x2=resume(sc,null)\n        yield(\"Second:\"+x2)\n        def x3=resume(sc,null)\n        print\"Finishing process coroutine.\"\n    }\n    coroutine(processCoFun)\n}\n\ndef sourceCo(){\n    def sourceCoFun(unused){\n        yield(1)\n        print\"Running source coroutine.\"\n        yield(2)\n    }\n    coroutine(sourceCoFun)\n}\n\ndef fc=feedCo()\ndef r1=resume(fc,null)\ndef r2=resume(fc,null)\ndef r3=resume(fc,null)\n\nprint \"End.\"\n": "[{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"feedCo\"},\"value\":{\"body\":[{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"sc\"},\"value\":{\"function\":{\"type\":\"id\",\"name\":\"sourceCo\"},\"type\":\"call\",\"arguments\":[]}},{\"type\":\"print\",\"value\":{\"type\":\"string-lit\",\"value\":\"Created source coroutine.\"}},{\"body\":{\"function\":{\"type\":\"id\",\"name\":\"process\"},\"type\":\"call\",\"arguments\":[{\"type\":\"id\",\"name\":\"sc\"}]},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[]}},{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"process\"},\"value\":{\"body\":[{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"processCoFun\"},\"value\":{\"body\":[{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"x1\"},\"value\":{\"arg\":{\"type\":\"null\"},\"type\":\"resume\",\"coroutine\":{\"type\":\"id\",\"name\":\"sc\"}}},{\"type\":\"print\",\"value\":{\"type\":\"string-lit\",\"value\":\"Running process coroutine.\"}},{\"body\":{\"type\":\"yield\",\"arg\":{\"operand1\":{\"type\":\"string-lit\",\"value\":\"First:\"},\"type\":\"+\",\"operand2\":{\"type\":\"id\",\"name\":\"x1\"}}},\"type\":\"exp\"},{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"x2\"},\"value\":{\"arg\":{\"type\":\"null\"},\"type\":\"resume\",\"coroutine\":{\"type\":\"id\",\"name\":\"sc\"}}},{\"body\":{\"type\":\"yield\",\"arg\":{\"operand1\":{\"type\":\"string-lit\",\"value\":\"Second:\"},\"type\":\"+\",\"operand2\":{\"type\":\"id\",\"name\":\"x2\"}}},\"type\":\"exp\"},{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"x3\"},\"value\":{\"arg\":{\"type\":\"null\"},\"type\":\"resume\",\"coroutine\":{\"type\":\"id\",\"name\":\"sc\"}}},{\"type\":\"print\",\"value\":{\"type\":\"string-lit\",\"value\":\"Finishing process coroutine.\"}}],\"type\":\"lambda\",\"arguments\":[{\"type\":\"id\",\"name\":\"unused\"}]}},{\"body\":{\"body\":{\"type\":\"id\",\"name\":\"processCoFun\"},\"type\":\"coroutine\"},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[{\"type\":\"id\",\"name\":\"sc\"}]}},{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"sourceCo\"},\"value\":{\"body\":[{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"sourceCoFun\"},\"value\":{\"body\":[{\"body\":{\"type\":\"yield\",\"arg\":{\"type\":\"int-lit\",\"value\":1}},\"type\":\"exp\"},{\"type\":\"print\",\"value\":{\"type\":\"string-lit\",\"value\":\"Running source coroutine.\"}},{\"body\":{\"type\":\"yield\",\"arg\":{\"type\":\"int-lit\",\"value\":2}},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[{\"type\":\"id\",\"name\":\"unused\"}]}},{\"body\":{\"body\":{\"type\":\"id\",\"name\":\"sourceCoFun\"},\"type\":\"coroutine\"},\"type\":\"exp\"}],\"type\":\"lambda\",\"arguments\":[]}},{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"fc\"},\"value\":{\"function\":{\"type\":\"id\",\"name\":\"feedCo\"},\"type\":\"call\",\"arguments\":[]}},{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"r1\"},\"value\":{\"arg\":{\"type\":\"null\"},\"type\":\"resume\",\"coroutine\":{\"type\":\"id\",\"name\":\"fc\"}}},{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"r2\"},\"value\":{\"arg\":{\"type\":\"null\"},\"type\":\"resume\",\"coroutine\":{\"type\":\"id\",\"name\":\"fc\"}}},{\"type\":\"def\",\"name\":{\"type\":\"id\",\"name\":\"r3\"},\"value\":{\"arg\":{\"type\":\"null\"},\"type\":\"resume\",\"coroutine\":{\"type\":\"id\",\"name\":\"fc\"}}},{\"type\":\"print\",\"value\":{\"type\":\"string-lit\",\"value\":\"End.\"}}]"
}